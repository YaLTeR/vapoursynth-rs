<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `vapoursynth` crate."><meta name="keywords" content="rust, rustlang, rust-lang, vapoursynth"><title>vapoursynth - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="shortcut icon" href="../favicon.ico"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../vapoursynth/index.html'><div class='logo-container'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Crate vapoursynth</p><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all vapoursynth's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'vapoursynth', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/vapoursynth/lib.rs.html#1-214' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>vapoursynth</a></span></h1><div class='docblock'><p>A safe wrapper for <a href="https://github.com/vapoursynth/vapoursynth">VapourSynth</a>, written in Rust.</p>
<p>The primary goal is safety (that is, safe Rust code should not trigger undefined behavior), and
secondary goals include performance and ease of use.</p>
<h2 id="functionality" class="section-header"><a href="#functionality">Functionality</a></h2>
<p>Most of the VapourSynth API is covered. It's possible to evaluate <code>.vpy</code> scripts, access their
properties and output, retrieve frames; enumerate loaded plugins and invoke their functions as
well as create VapourSynth filters.</p>
<p>For an example usage see
<a href="https://github.com/YaLTeR/vapoursynth-rs/blob/master/vapoursynth/examples/vspipe.rs">examples/vspipe.rs</a>,
a complete reimplementation of VapourSynth's
<a href="https://github.com/vapoursynth/vapoursynth/blob/master/src/vspipe/vspipe.cpp">vspipe</a> in safe
Rust utilizing this crate.</p>
<p>For a VapourSynth plugin example see
<a href="https://github.com/YaLTeR/vapoursynth-rs/blob/master/sample-plugin">sample-plugin</a> which
implements some simple filters.</p>
<h2 id="short-example" class="section-header"><a href="#short-example">Short example</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">vapoursynth</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;

<span class="kw">let</span> <span class="ident">env</span> <span class="op">=</span> <span class="ident">Environment</span>::<span class="ident">from_file</span>(<span class="string">&quot;test.vpy&quot;</span>, <span class="ident">EvalFlags</span>::<span class="ident">SetWorkingDir</span>)<span class="question-mark">?</span>;
<span class="kw">let</span> <span class="ident">node</span> <span class="op">=</span> <span class="ident">env</span>.<span class="ident">get_output</span>(<span class="number">0</span>)<span class="question-mark">?</span>.<span class="number">0</span>; <span class="comment">// Without `.0` for VSScript API 3.0</span>
<span class="kw">let</span> <span class="ident">frame</span> <span class="op">=</span> <span class="ident">node</span>.<span class="ident">get_frame</span>(<span class="number">0</span>)<span class="question-mark">?</span>;

<span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;Resolution: {}×{}&quot;</span>, <span class="ident">frame</span>.<span class="ident">width</span>(<span class="number">0</span>), <span class="ident">frame</span>.<span class="ident">height</span>(<span class="number">0</span>));</pre></div>
<h2 id="plugins" class="section-header"><a href="#plugins">Plugins</a></h2>
<p>To make a VapourSynth plugin, start by creating a new Rust library with
<code>crate-type = [&quot;cdylib&quot;]</code>. Then add filters by implementing the <code>plugins::Filter</code> trait. Bind
them to functions by implementing <code>plugins::FilterFunction</code>, which is much more easily done via
the <code>make_filter_function!</code> macro. Finally, put <code>export_vapoursynth_plugin!</code> at the top level
of <code>src/lib.rs</code> to export the functionality.</p>
<p><strong>Important note:</strong> due to what seems to be a
<a href="https://github.com/rust-lang/rust/issues/50176">bug</a> in rustc, it's impossible to make plugins
on the <code>i686-pc-windows-gnu</code> target (all other variations of <code>x86_64</code> and <code>i686</code> do work).
Please use <code>i686-pc-windows-msvc</code> for an i686 Windows plugin.</p>
<h2 id="short-plugin-example" class="section-header"><a href="#short-plugin-example">Short plugin example</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="attribute">#[<span class="ident">macro_use</span>]</span>
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">failure</span>;
<span class="attribute">#[<span class="ident">macro_use</span>]</span>
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">vapoursynth</span>;

<span class="kw">use</span> <span class="ident">failure</span>::<span class="ident">Error</span>;
<span class="kw">use</span> <span class="ident">vapoursynth</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">vapoursynth</span>::<span class="ident">core</span>::<span class="ident">CoreRef</span>;
<span class="kw">use</span> <span class="ident">vapoursynth</span>::<span class="ident">plugins</span>::{<span class="ident">Filter</span>, <span class="ident">FilterArgument</span>, <span class="ident">FrameContext</span>, <span class="ident">Metadata</span>};
<span class="kw">use</span> <span class="ident">vapoursynth</span>::<span class="ident">video_info</span>::<span class="ident">VideoInfo</span>;

<span class="comment">// A simple filter that passes the frames through unchanged.</span>
<span class="kw">struct</span> <span class="ident">Passthrough</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> {
    <span class="ident">source</span>: <span class="ident">Node</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> <span class="ident">Filter</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">Passthrough</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">video_info</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">_api</span>: <span class="ident">API</span>, <span class="ident">_core</span>: <span class="ident">CoreRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">VideoInfo</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="macro">vec</span><span class="macro">!</span>[<span class="self">self</span>.<span class="ident">source</span>.<span class="ident">info</span>()]
    }

    <span class="kw">fn</span> <span class="ident">get_frame_initial</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="ident">_api</span>: <span class="ident">API</span>,
        <span class="ident">_core</span>: <span class="ident">CoreRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
        <span class="ident">context</span>: <span class="ident">FrameContext</span>,
        <span class="ident">n</span>: <span class="ident">usize</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">FrameRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span><span class="op">&gt;</span>, <span class="ident">Error</span><span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">source</span>.<span class="ident">request_frame_filter</span>(<span class="ident">context</span>, <span class="ident">n</span>);
        <span class="prelude-val">Ok</span>(<span class="prelude-val">None</span>)
    }

    <span class="kw">fn</span> <span class="ident">get_frame</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="ident">_api</span>: <span class="ident">API</span>,
        <span class="ident">_core</span>: <span class="ident">CoreRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
        <span class="ident">context</span>: <span class="ident">FrameContext</span>,
        <span class="ident">n</span>: <span class="ident">usize</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">FrameRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>, <span class="ident">Error</span><span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">source</span>
            .<span class="ident">get_frame_filter</span>(<span class="ident">context</span>, <span class="ident">n</span>)
            .<span class="ident">ok_or</span>(<span class="macro">format_err</span><span class="macro">!</span>(<span class="string">&quot;Couldn&#39;t get the source frame&quot;</span>))
    }
}

<span class="macro">make_filter_function</span><span class="macro">!</span> {
    <span class="ident">PassthroughFunction</span>, <span class="string">&quot;Passthrough&quot;</span>

    <span class="kw">fn</span> <span class="ident">create_passthrough</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>(
        <span class="ident">_api</span>: <span class="ident">API</span>,
        <span class="ident">_core</span>: <span class="ident">CoreRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
        <span class="ident">clip</span>: <span class="ident">Node</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Box</span><span class="op">&lt;</span><span class="ident">Filter</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> <span class="op">+</span> <span class="lifetime">&#39;core</span><span class="op">&gt;</span><span class="op">&gt;</span>, <span class="ident">Error</span><span class="op">&gt;</span> {
        <span class="prelude-val">Ok</span>(<span class="prelude-val">Some</span>(<span class="ident">Box</span>::<span class="ident">new</span>(<span class="ident">Passthrough</span> { <span class="ident">source</span>: <span class="ident">clip</span> })))
    }
}

<span class="macro">export_vapoursynth_plugin</span><span class="macro">!</span> {
    <span class="ident">Metadata</span> {
        <span class="ident">identifier</span>: <span class="string">&quot;com.example.passthrough&quot;</span>,
        <span class="ident">namespace</span>: <span class="string">&quot;passthrough&quot;</span>,
        <span class="ident">name</span>: <span class="string">&quot;Example Plugin&quot;</span>,
        <span class="ident">read_only</span>: <span class="bool-val">true</span>,
    },
    [<span class="ident">PassthroughFunction</span>::<span class="ident">new</span>()]
}</pre></div>
<p>Check <a href="https://github.com/YaLTeR/vapoursynth-rs/blob/master/sample-plugin">sample-plugin</a> for
an example plugin which exports some simple filters.</p>
<h2 id="supported-versions" class="section-header"><a href="#supported-versions">Supported Versions</a></h2>
<p>All VapourSynth and VSScript API versions starting with 3.0 are supported. By default the
crates use the 3.0 feature set. To enable higher API version support, enable one of the
following Cargo features:</p>
<ul>
<li><code>vapoursynth-api-31</code> for VapourSynth API 3.1</li>
<li><code>vapoursynth-api-32</code> for VapourSynth API 3.2</li>
<li><code>vapoursynth-api-33</code> for VapourSynth API 3.3</li>
<li><code>vapoursynth-api-34</code> for VapourSynth API 3.4</li>
<li><code>vapoursynth-api-35</code> for VapourSynth API 3.5</li>
<li><code>vsscript-api-31</code> for VSScript API 3.1</li>
<li><code>vsscript-api-32</code> for VSScript API 3.2</li>
</ul>
<p>To enable linking to VapourSynth or VSScript functions, enable the following Cargo features:</p>
<ul>
<li><code>vapoursynth-functions</code> for VapourSynth functions (<code>getVapourSynthAPI()</code>)</li>
<li><code>vsscript-functions</code> for VSScript functions (<code>vsscript_*()</code>)</li>
</ul>
<h2 id="building" class="section-header"><a href="#building">Building</a></h2>
<p>Make sure you have the corresponding libraries available if you enable the linking features.
You can use the <code>VAPOURSYNTH_LIB_DIR</code> environment variable to specify a custom directory with
the library files.</p>
<p>On Windows the easiest way is to use the VapourSynth installer (make sure the VapourSynth SDK
is checked). The crate should pick up the library directory automatically. If it doesn't or if
you're cross-compiling, set <code>VAPOURSYNTH_LIB_DIR</code> to
<code>&lt;path to the VapourSynth installation&gt;\sdk\lib64</code> or <code>&lt;...&gt;\lib32</code>, depending on the target
bitness.</p>
</div><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table><tr class='module-item'><td><a class="mod" href="api/index.html" title='vapoursynth::api mod'>api</a></td><td class='docblock-short'><p>Most general VapourSynth API functions.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="component/index.html" title='vapoursynth::component mod'>component</a></td><td class='docblock-short'><p>The pixel component trait.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="core/index.html" title='vapoursynth::core mod'>core</a></td><td class='docblock-short'><p>VapourSynth cores.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="format/index.html" title='vapoursynth::format mod'>format</a></td><td class='docblock-short'><p>VapourSynth frame formats.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="frame/index.html" title='vapoursynth::frame mod'>frame</a></td><td class='docblock-short'><p>VapourSynth frames.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="function/index.html" title='vapoursynth::function mod'>function</a></td><td class='docblock-short'><p>VapourSynth callable functions.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="map/index.html" title='vapoursynth::map mod'>map</a></td><td class='docblock-short'><p>VapourSynth maps.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="node/index.html" title='vapoursynth::node mod'>node</a></td><td class='docblock-short'><p>VapourSynth nodes.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="plugin/index.html" title='vapoursynth::plugin mod'>plugin</a></td><td class='docblock-short'><p>VapourSynth plugins.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="plugins/index.html" title='vapoursynth::plugins mod'>plugins</a></td><td class='docblock-short'><p>Things related to making VapourSynth plugins.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="prelude/index.html" title='vapoursynth::prelude mod'>prelude</a></td><td class='docblock-short'><p>The VapourSynth prelude.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="video_info/index.html" title='vapoursynth::video_info mod'>video_info</a></td><td class='docblock-short'><p>Video clip formats.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="vsscript/index.html" title='vapoursynth::vsscript mod'>vsscript</a></td><td class='docblock-short'><p>VapourSynth script-related things.</p>
</td></tr></table><h2 id='macros' class='section-header'><a href="#macros">Macros</a></h2>
<table><tr class='module-item'><td><a class="macro" href="macro.export_vapoursynth_plugin.html" title='vapoursynth::export_vapoursynth_plugin macro'>export_vapoursynth_plugin</a></td><td class='docblock-short'><p>Exports a VapourSynth plugin from this library.</p>
</td></tr><tr class='module-item'><td><a class="macro" href="macro.make_filter_function.html" title='vapoursynth::make_filter_function macro'>make_filter_function</a></td><td class='docblock-short'><p>Make a filter function easily and avoid boilerplate.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "vapoursynth";</script><script src="../aliases.js"></script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>