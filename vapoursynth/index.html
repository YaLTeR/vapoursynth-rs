<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A safe wrapper for VapourSynth, written in Rust."><meta name="keywords" content="rust, rustlang, rust-lang, vapoursynth"><title>vapoursynth - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a class="sidebar-logo" href="../vapoursynth/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.png" alt="logo"></div>
        </a><h2 class="location">Crate vapoursynth</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.3.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all vapoursynth's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li></ul></div><div id="sidebar-vars" data-name="vapoursynth" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../vapoursynth/index.html"><img class="rust-logo" src="../rust-logo.png" alt="logo"></a><nav class="sub"><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">vapoursynth</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/vapoursynth/lib.rs.html#1-208" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A safe wrapper for <a href="https://github.com/vapoursynth/vapoursynth">VapourSynth</a>, written in Rust.</p>
<p>The primary goal is safety (that is, safe Rust code should not trigger undefined behavior), and
secondary goals include performance and ease of use.</p>
<h3 id="functionality" class="section-header"><a href="#functionality">Functionality</a></h3>
<p>Most of the VapourSynth API is covered. It’s possible to evaluate <code>.vpy</code> scripts, access their
properties and output, retrieve frames; enumerate loaded plugins and invoke their functions as
well as create VapourSynth filters.</p>
<p>For an example usage see
<a href="https://github.com/YaLTeR/vapoursynth-rs/blob/master/vapoursynth/examples/vspipe.rs">examples/vspipe.rs</a>,
a complete reimplementation of VapourSynth’s
<a href="https://github.com/vapoursynth/vapoursynth/blob/master/src/vspipe/vspipe.cpp">vspipe</a> in safe
Rust utilizing this crate.</p>
<p>For a VapourSynth plugin example see
<a href="https://github.com/YaLTeR/vapoursynth-rs/blob/master/sample-plugin">sample-plugin</a> which
implements some simple filters.</p>
<h3 id="short-example" class="section-header"><a href="#short-example">Short example</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">vapoursynth::prelude</span>::<span class="kw-2">*</span>;

<span class="kw">let</span> <span class="ident">env</span> <span class="op">=</span> <span class="ident">Environment::from_file</span>(<span class="string">&quot;test.vpy&quot;</span>, <span class="ident">EvalFlags::SetWorkingDir</span>)<span class="question-mark">?</span>;
<span class="kw">let</span> <span class="ident">node</span> <span class="op">=</span> <span class="ident">env</span>.<span class="ident">get_output</span>(<span class="number">0</span>)<span class="question-mark">?</span>.<span class="number">0</span>; <span class="comment">// Without `.0` for VSScript API 3.0</span>
<span class="kw">let</span> <span class="ident">frame</span> <span class="op">=</span> <span class="ident">node</span>.<span class="ident">get_frame</span>(<span class="number">0</span>)<span class="question-mark">?</span>;

<span class="macro">println!</span>(<span class="string">&quot;Resolution: {}×{}&quot;</span>, <span class="ident">frame</span>.<span class="ident">width</span>(<span class="number">0</span>), <span class="ident">frame</span>.<span class="ident">height</span>(<span class="number">0</span>));</code></pre></div>
<h3 id="plugins" class="section-header"><a href="#plugins">Plugins</a></h3>
<p>To make a VapourSynth plugin, start by creating a new Rust library with
<code>crate-type = [&quot;cdylib&quot;]</code>. Then add filters by implementing the <code>plugins::Filter</code> trait. Bind
them to functions by implementing <code>plugins::FilterFunction</code>, which is much more easily done via
the <code>make_filter_function!</code> macro. Finally, put <code>export_vapoursynth_plugin!</code> at the top level
of <code>src/lib.rs</code> to export the functionality.</p>
<p><strong>Important note:</strong> due to what seems to be a
<a href="https://github.com/rust-lang/rust/issues/50176">bug</a> in rustc, it’s impossible to make plugins
on the <code>i686-pc-windows-gnu</code> target (all other variations of <code>x86_64</code> and <code>i686</code> do work).
Please use <code>i686-pc-windows-msvc</code> for an i686 Windows plugin.</p>
<h3 id="short-plugin-example" class="section-header"><a href="#short-plugin-example">Short plugin example</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">macro_use</span>]</span>
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">vapoursynth</span>;

<span class="kw">use</span> <span class="ident">anyhow</span>::{<span class="ident">anyhow</span>, <span class="ident">Error</span>};
<span class="kw">use</span> <span class="ident">vapoursynth::prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">vapoursynth::core::CoreRef</span>;
<span class="kw">use</span> <span class="ident">vapoursynth::plugins</span>::{<span class="ident">Filter</span>, <span class="ident">FilterArgument</span>, <span class="ident">FrameContext</span>, <span class="ident">Metadata</span>};
<span class="kw">use</span> <span class="ident">vapoursynth::video_info::VideoInfo</span>;

<span class="comment">// A simple filter that passes the frames through unchanged.</span>
<span class="kw">struct</span> <span class="ident">Passthrough</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> {
    <span class="ident">source</span>: <span class="ident">Node</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> <span class="ident">Filter</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">Passthrough</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">video_info</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">_api</span>: <span class="ident">API</span>, <span class="ident">_core</span>: <span class="ident">CoreRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>) -&gt; <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">VideoInfo</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="macro">vec!</span>[<span class="self">self</span>.<span class="ident">source</span>.<span class="ident">info</span>()]
    }

    <span class="kw">fn</span> <span class="ident">get_frame_initial</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="ident">_api</span>: <span class="ident">API</span>,
        <span class="ident">_core</span>: <span class="ident">CoreRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
        <span class="ident">context</span>: <span class="ident">FrameContext</span>,
        <span class="ident">n</span>: <span class="ident">usize</span>,
    ) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">FrameRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span><span class="op">&gt;</span>, <span class="ident">Error</span><span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">source</span>.<span class="ident">request_frame_filter</span>(<span class="ident">context</span>, <span class="ident">n</span>);
        <span class="prelude-val">Ok</span>(<span class="prelude-val">None</span>)
    }

    <span class="kw">fn</span> <span class="ident">get_frame</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="ident">_api</span>: <span class="ident">API</span>,
        <span class="ident">_core</span>: <span class="ident">CoreRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
        <span class="ident">context</span>: <span class="ident">FrameContext</span>,
        <span class="ident">n</span>: <span class="ident">usize</span>,
    ) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">FrameRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>, <span class="ident">Error</span><span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">source</span>
            .<span class="ident">get_frame_filter</span>(<span class="ident">context</span>, <span class="ident">n</span>)
            .<span class="ident">ok_or</span>(<span class="macro">anyhow!</span>(<span class="string">&quot;Couldn&#39;t get the source frame&quot;</span>))
    }
}

<span class="macro">make_filter_function!</span> {
    <span class="ident">PassthroughFunction</span>, <span class="string">&quot;Passthrough&quot;</span>

    <span class="kw">fn</span> <span class="ident">create_passthrough</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>(
        <span class="ident">_api</span>: <span class="ident">API</span>,
        <span class="ident">_core</span>: <span class="ident">CoreRef</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
        <span class="ident">clip</span>: <span class="ident">Node</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span>,
    ) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="ident">Filter</span><span class="op">&lt;</span><span class="lifetime">&#39;core</span><span class="op">&gt;</span> <span class="op">+</span> <span class="lifetime">&#39;core</span><span class="op">&gt;</span><span class="op">&gt;</span>, <span class="ident">Error</span><span class="op">&gt;</span> {
        <span class="prelude-val">Ok</span>(<span class="prelude-val">Some</span>(<span class="ident">Box::new</span>(<span class="ident">Passthrough</span> { <span class="ident">source</span>: <span class="ident">clip</span> })))
    }
}

<span class="macro">export_vapoursynth_plugin!</span> {
    <span class="ident">Metadata</span> {
        <span class="ident">identifier</span>: <span class="string">&quot;com.example.passthrough&quot;</span>,
        <span class="ident">namespace</span>: <span class="string">&quot;passthrough&quot;</span>,
        <span class="ident">name</span>: <span class="string">&quot;Example Plugin&quot;</span>,
        <span class="ident">read_only</span>: <span class="bool-val">true</span>,
    },
    [<span class="ident">PassthroughFunction::new</span>()]
}</code></pre></div>
<p>Check <a href="https://github.com/YaLTeR/vapoursynth-rs/blob/master/sample-plugin">sample-plugin</a> for
an example plugin which exports some simple filters.</p>
<h3 id="supported-versions" class="section-header"><a href="#supported-versions">Supported Versions</a></h3>
<p>All VapourSynth and VSScript API versions starting with 3.0 are supported. By default the
crates use the 3.0 feature set. To enable higher API version support, enable one of the
following Cargo features:</p>
<ul>
<li><code>vapoursynth-api-31</code> for VapourSynth API 3.1</li>
<li><code>vapoursynth-api-32</code> for VapourSynth API 3.2</li>
<li><code>vapoursynth-api-33</code> for VapourSynth API 3.3</li>
<li><code>vapoursynth-api-34</code> for VapourSynth API 3.4</li>
<li><code>vapoursynth-api-35</code> for VapourSynth API 3.5</li>
<li><code>vsscript-api-31</code> for VSScript API 3.1</li>
<li><code>vsscript-api-32</code> for VSScript API 3.2</li>
</ul>
<p>To enable linking to VapourSynth or VSScript functions, enable the following Cargo features:</p>
<ul>
<li><code>vapoursynth-functions</code> for VapourSynth functions (<code>getVapourSynthAPI()</code>)</li>
<li><code>vsscript-functions</code> for VSScript functions (<code>vsscript_*()</code>)</li>
</ul>
<h3 id="building" class="section-header"><a href="#building">Building</a></h3>
<p>Make sure you have the corresponding libraries available if you enable the linking features.
You can use the <code>VAPOURSYNTH_LIB_DIR</code> environment variable to specify a custom directory with
the library files.</p>
<p>On Windows the easiest way is to use the VapourSynth installer (make sure the VapourSynth SDK
is checked). The crate should pick up the library directory automatically. If it doesn’t or if
you’re cross-compiling, set <code>VAPOURSYNTH_LIB_DIR</code> to
<code>&lt;path to the VapourSynth installation&gt;\sdk\lib64</code> or <code>&lt;...&gt;\lib32</code>, depending on the target
bitness.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="api/index.html" title="vapoursynth::api mod">api</a></div><div class="item-right docblock-short"><p>Most general VapourSynth API functions.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="component/index.html" title="vapoursynth::component mod">component</a></div><div class="item-right docblock-short"><p>The pixel component trait.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="core/index.html" title="vapoursynth::core mod">core</a></div><div class="item-right docblock-short"><p>VapourSynth cores.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="format/index.html" title="vapoursynth::format mod">format</a></div><div class="item-right docblock-short"><p>VapourSynth frame formats.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="frame/index.html" title="vapoursynth::frame mod">frame</a></div><div class="item-right docblock-short"><p>VapourSynth frames.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="function/index.html" title="vapoursynth::function mod">function</a></div><div class="item-right docblock-short"><p>VapourSynth callable functions.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="map/index.html" title="vapoursynth::map mod">map</a></div><div class="item-right docblock-short"><p>VapourSynth maps.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="node/index.html" title="vapoursynth::node mod">node</a></div><div class="item-right docblock-short"><p>VapourSynth nodes.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="plugin/index.html" title="vapoursynth::plugin mod">plugin</a></div><div class="item-right docblock-short"><p>VapourSynth plugins.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="plugins/index.html" title="vapoursynth::plugins mod">plugins</a></div><div class="item-right docblock-short"><p>Things related to making VapourSynth plugins.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="prelude/index.html" title="vapoursynth::prelude mod">prelude</a></div><div class="item-right docblock-short"><p>The VapourSynth prelude.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="video_info/index.html" title="vapoursynth::video_info mod">video_info</a></div><div class="item-right docblock-short"><p>Video clip formats.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="vsscript/index.html" title="vapoursynth::vsscript mod">vsscript</a></div><div class="item-right docblock-short"><p>VapourSynth script-related things.</p>
</div></div></div><h2 id="macros" class="small-section-header"><a href="#macros">Macros</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="macro" href="macro.export_vapoursynth_plugin.html" title="vapoursynth::export_vapoursynth_plugin macro">export_vapoursynth_plugin</a></div><div class="item-right docblock-short"><p>Exports a VapourSynth plugin from this library.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="macro" href="macro.make_filter_function.html" title="vapoursynth::make_filter_function macro">make_filter_function</a></div><div class="item-right docblock-short"><p>Make a filter function easily and avoid boilerplate.</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="vapoursynth" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.59.0 (9d1b2106e 2022-02-23)" ></div>
</body></html>